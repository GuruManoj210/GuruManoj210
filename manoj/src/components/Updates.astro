---
import Section from './Section';
import { getCollection } from 'astro:content';
const allUpdates = (await getCollection('updates')).sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const updates = allUpdates.slice(0, 3);
const hasMore = allUpdates.length > 3;
---
<Section client:visible id="updates" title="Updates">
  <div class="grid gap-3 sm:gap-4">
    {updates.length > 0 ? updates.map(u => (
      <a class="card p-4 sm:p-5 block hover:bg-white/80 dark:hover:bg-white/10 hover:scale-[1.01] transition-all group" href={`/updates/${u.slug}`}>
        <h3 class="font-semibold text-base sm:text-lg break-words group-hover:text-gray-700 dark:group-hover:text-gray-300 transition">ðŸ“¡ {u.data.title}</h3>
        <p class="text-xs sm:text-sm opacity-70 mt-1">ðŸ“… {new Date(u.data.date).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: '2-digit' })}</p>
        {u.data.summary && <p class="mt-2 opacity-90 text-sm sm:text-base leading-relaxed break-words">{u.data.summary}</p>}
      </a>
    )) : (
      <div class="card p-4 sm:p-6 opacity-80 text-center">
        <div class="text-3xl mb-3">ðŸ“¢</div>
        <p class="text-sm sm:text-base break-words">Add markdown files under <code class="px-2 py-1 rounded bg-gray-200 dark:bg-white/10 text-xs">src/content/updates</code>.</p>
      </div>
    )}
  </div>
  {hasMore && (
    <div class="mt-6 text-center">
      <a href="/updates" class="inline-flex items-center gap-2 px-6 py-3 rounded-lg border-2 border-gray-700 dark:border-gray-300 text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-700 hover:text-white dark:hover:bg-gray-300 dark:hover:text-gray-900 hover:shadow-lg hover:scale-105 transition-all">
        See All Updates
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>
    </div>
  )}
</Section>

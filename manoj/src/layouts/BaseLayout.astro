---
import '../styles/global.css';
import ThemeToggle from '@components/ThemeToggle.astro';
import Navbar from '@components/Navbar.astro';
import Footer from '@components/Footer.astro';
import site from '@data/site.config';
import NeuralBg from '@components/NeuralBg';
---
<!doctype html>
<html lang={site.site.locale}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={site.site.description} />
    <meta name="keywords" content={site.site.keywords.join(', ')} />
    <meta name="theme-color" content={site.site.themeColor} />
    <link rel="icon" href="/favicon.ico" />
    <title>{site.site.title}</title>
  </head>
  <body class="relative">
    <div class="fixed inset-0 -z-10 bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-950 dark:to-black">
      <NeuralBg client:load />
    </div>
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:bg-black focus:text-white focus:px-3 focus:py-1 rounded">Skip to content</a>
    <header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-transform duration-300 will-change-transform">
      <div class="container py-2 sm:py-3">
        <div class="flex items-center justify-between rounded-lg sm:rounded-xl border border-white/10 bg-white/70 dark:bg-black/30 backdrop-blur-md shadow-sm px-3 sm:px-4 py-2 sm:py-2.5 gap-3">
          <div class="flex-1 min-w-0 overflow-hidden">
            <Navbar />
          </div>
          <div class="flex-shrink-0">
            <ThemeToggle />
          </div>
        </div>
      </div>
    </header>
    <main id="main" class="container pt-24 pb-20">
      <slot />
    </main>
    <Footer />
    <script>
      // Persist theme from localStorage early to avoid FOUC
      // Default to light mode if no preference is stored
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
        if (!theme) localStorage.setItem('theme', 'light');
      }
      
      // Hide-on-scroll-down, show-on-scroll-up for header
      (function () {
        const header = document.getElementById('site-header');
        if (!header) return;
        let lastY = window.scrollY;
        let ticking = false;

        function updateHeader() {
          const y = window.scrollY;
          
          // Show when at top
          if (y < 10) {
            header.classList.remove('-translate-y-full');
          }
          // Hide when scrolling down past threshold
          else if (y > lastY && y > 100) {
            header.classList.add('-translate-y-full');
          }
          // Show when scrolling up
          else if (y < lastY) {
            header.classList.remove('-translate-y-full');
          }
          
          lastY = y;
          ticking = false;
        }

        function onScroll() {
          if (!ticking) {
            window.requestAnimationFrame(updateHeader);
            ticking = true;
          }
        }

        window.addEventListener('scroll', onScroll, { passive: true });
      })();
    </script>
  </body>
</html>
